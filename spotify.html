<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="spotifyCss.css" rel="stylesheet" type="text/css" />
    <link rel="icon" href="spotify.ico" type="image/x-icon">
    <title>Phrenzye's Spotify</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>Phrenzye's Spotify</h1>
            <p class="subtitle">Мой плейлист Spotify со всеми треками</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-tracks">0</div>
                    <div class="stat-label">Всего треков</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="unique-artists">0</div>
                    <div class="stat-label">Уникальных исполнителей</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="explicit-count">0</div>
                    <div class="stat-label">Треков с Explicit</div>
                </div>
            </div>

            <div class="return-link">
                <a href="index.html" title="Вернуться к оценкам">
                    <img src="favicon.ico" alt="Вернуться" class="return-icon">
                </a>
            </div>
        </header>

        <div class="controls">
            <input type="text" id="search-input" placeholder="Поиск по названию или исполнителю...">
            <button id="sort-alphabet">А-Я</button>
            <button id="sort-recent">Сначала новые</button>
            <button id="sort-popular">По популярности</button>
        </div>
        
        <main>
            <div class="tracks-list" id="tracks-container">
                <div class="loading" id="loading-message">Загрузка данных из CSV файла...</div>
            </div>
        </main>
        
        <footer>
            <p>Создано с помощью Spotify данных &copy; 2025</p>
        </footer>
    </div>

    <script>
        // Переменная для хранения всех треков
        let allTracks = [];
        
        // Функция для парсинга CSV данных
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            
            const tracks = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                // Простой парсинг CSV (для более сложных случаев нужна библиотека)
                const values = [];
                let currentValue = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(currentValue);
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                
                values.push(currentValue);
                
                // Создаем объект трека
                const track = {
                    name: values[1] || 'Неизвестный трек',
                    artist: values[3] || 'Неизвестный исполнитель',
                    album: values[2] || 'Неизвестный альбом',
                    popularity: parseInt(values[6]) || 0,
                    explicit: values[7] === 'true',
                    releaseDate: values[4] || 'Неизвестная дата',
                    duration: parseInt(values[5]) || 0,
                    genres: values[10] || ''
                };
                
                tracks.push(track);
            }
            
            return tracks;
        }
        
        // Функция для загрузки CSV файла
        async function loadCSVFile() {
            try {
                const response = await fetch('Liked_Songs.csv');
                if (!response.ok) {
                    throw new Error(`Ошибка загрузки файла: ${response.status}`);
                }
                
                const csvText = await response.text();
                return parseCSV(csvText);
            } catch (error) {
                console.error('Ошибка загрузки CSV файла:', error);
                document.getElementById('loading-message').textContent = 'Ошибка загрузки файла Liked_Songs.csv';
                return [];
            }
        }
        
        // Функция для отображения треков
        function displayTracks(tracksToDisplay) {
            const container = document.getElementById('tracks-container');
            container.innerHTML = '';
            
            if (tracksToDisplay.length === 0) {
                container.innerHTML = '<div class="no-results">Треки не найдены. Попробуйте изменить поисковый запрос.</div>';
                return;
            }
            
            tracksToDisplay.forEach(track => {
                const trackItem = document.createElement('div');
                trackItem.className = 'track-item';
                
                trackItem.innerHTML = `
                    <div class="track-info">
                        <div class="track-name" title="${track.name}">${track.name}</div>
                        <div class="artist-name" title="${track.artist}">${track.artist}</div>
                        <div class="album-name" title="${track.album}">${track.album}</div>
                    </div>
                    <div class="track-meta">
                        <div class="popularity">${track.popularity}%</div>
                        ${track.explicit ? '<div class="explicit">Explicit</div>' : ''}
                    </div>
                `;
                
                container.appendChild(trackItem);
            });
        }
        
        // Функция для обновления статистики
        function updateStats(tracks) {
            document.getElementById('total-tracks').textContent = tracks.length;
            
            // Подсчет уникальных исполнителей
            const artists = new Set();
            tracks.forEach(track => {
                track.artist.split(';').forEach(artist => artists.add(artist.trim()));
            });
            document.getElementById('unique-artists').textContent = artists.size;
            
            // Подсчет треков с Explicit
            const explicitCount = tracks.filter(track => track.explicit).length;
            document.getElementById('explicit-count').textContent = explicitCount;
        }
        
        // Функция для поиска треков
        function searchTracks(query) {
            if (!query) return allTracks;
            
            const lowerQuery = query.toLowerCase();
            return allTracks.filter(track => 
                track.name.toLowerCase().includes(lowerQuery) || 
                track.artist.toLowerCase().includes(lowerQuery) ||
                track.album.toLowerCase().includes(lowerQuery)
            );
        }
        
        // Функция для сортировки треков
        function sortTracks(sortBy, tracksToSort) {
            const sortedTracks = [...tracksToSort];
            
            switch(sortBy) {
                case 'alphabet':
                    sortedTracks.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'recent':
                    sortedTracks.sort((a, b) => new Date(b.releaseDate) - new Date(a.releaseDate));
                    break;
                case 'popular':
                    sortedTracks.sort((a, b) => b.popularity - a.popularity);
                    break;
                default:
                    break;
            }
            
            return sortedTracks;
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', async () => {
            // Загружаем данные из CSV файла
            allTracks = await loadCSVFile();
            
            if (allTracks.length > 0) {
                updateStats(allTracks);
                displayTracks(allTracks);
                
                // Обработчики событий для кнопок
                document.getElementById('sort-alphabet').addEventListener('click', () => {
                    const sorted = sortTracks('alphabet', allTracks);
                    displayTracks(sorted);
                    
                    // Обновление активной кнопки
                    document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    document.getElementById('sort-alphabet').classList.add('active');
                });
                
                document.getElementById('sort-recent').addEventListener('click', () => {
                    const sorted = sortTracks('recent', allTracks);
                    displayTracks(sorted);
                    
                    // Обновление активной кнопки
                    document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    document.getElementById('sort-recent').classList.add('active');
                });
                
                document.getElementById('sort-popular').addEventListener('click', () => {
                    const sorted = sortTracks('popular', allTracks);
                    displayTracks(sorted);
                    
                    // Обновление активной кнопки
                    document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    document.getElementById('sort-popular').classList.add('active');
                });
                
                // Обработчик для поиска
                document.getElementById('search-input').addEventListener('input', (e) => {
                    const query = e.target.value;
                    const results = searchTracks(query);
                    displayTracks(results);
                });
            }
        });
    </script>
</body>
</html>